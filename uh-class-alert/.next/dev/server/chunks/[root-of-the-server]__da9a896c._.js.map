{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/binivm/Projects/Mini-Projects/UH-Bot/uh-class-alert/src/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\nimport { PrismaNeon } from '@prisma/adapter-neon';\n\nconst globalForPrisma = globalThis as unknown as {\n    prisma: PrismaClient | undefined;\n};\n\nfunction createPrismaClient(): PrismaClient {\n    const connectionString = process.env.DATABASE_URL!;\n    const adapter = new PrismaNeon({ connectionString });\n\n    return new PrismaClient({ adapter });\n}\n\nexport const prisma = globalForPrisma.prisma ?? createPrismaClient();\n\nif (process.env.NODE_ENV !== 'production') {\n    globalForPrisma.prisma = prisma;\n}\n\nexport default prisma;\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,kBAAkB;AAIxB,SAAS;IACL,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;IACjD,MAAM,UAAU,IAAI,6KAAU,CAAC;QAAE;IAAiB;IAElD,OAAO,IAAI,sMAAY,CAAC;QAAE;IAAQ;AACtC;AAEO,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C;IACvC,gBAAgB,MAAM,GAAG;AAC7B;uCAEe"}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///Users/binivm/Projects/Mini-Projects/UH-Bot/uh-class-alert/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport { cookies } from 'next/headers';\nimport { prisma } from './db';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'dev-secret-change-in-prod';\nconst SESSION_COOKIE = 'uh-session';\nconst SESSION_EXPIRY = 60 * 60 * 24 * 30; // 30 days\n\ninterface SessionPayload {\n    userId: string;\n    email: string;\n}\n\nexport function generateVerifyToken(): string {\n    return Math.random().toString(36).substring(2) + Date.now().toString(36);\n}\n\nexport function createSessionToken(payload: SessionPayload): string {\n    return jwt.sign(payload, JWT_SECRET, { expiresIn: SESSION_EXPIRY });\n}\n\nexport function verifySessionToken(token: string): SessionPayload | null {\n    try {\n        return jwt.verify(token, JWT_SECRET) as SessionPayload;\n    } catch {\n        return null;\n    }\n}\n\nexport async function createSession(userId: string, email: string) {\n    const token = createSessionToken({ userId, email });\n    const cookieStore = await cookies();\n\n    cookieStore.set(SESSION_COOKIE, token, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        maxAge: SESSION_EXPIRY,\n        path: '/',\n    });\n\n    return token;\n}\n\nexport async function getSession(): Promise<SessionPayload | null> {\n    const cookieStore = await cookies();\n    const token = cookieStore.get(SESSION_COOKIE)?.value;\n\n    if (!token) return null;\n\n    return verifySessionToken(token);\n}\n\nexport async function destroySession() {\n    const cookieStore = await cookies();\n    cookieStore.delete(SESSION_COOKIE);\n}\n\nexport async function requireAuth() {\n    const session = await getSession();\n\n    if (!session) {\n        throw new Error('Unauthorized');\n    }\n\n    // Verify user still exists\n    const user = await prisma.user.findUnique({\n        where: { id: session.userId },\n    });\n\n    if (!user) {\n        await destroySession();\n        throw new Error('Unauthorized');\n    }\n\n    return { user, session };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB;AACvB,MAAM,iBAAiB,KAAK,KAAK,KAAK,IAAI,UAAU;AAO7C,SAAS;IACZ,OAAO,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,KAAK,KAAK,GAAG,GAAG,QAAQ,CAAC;AACzE;AAEO,SAAS,mBAAmB,OAAuB;IACtD,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAe;AACrE;AAEO,SAAS,mBAAmB,KAAa;IAC5C,IAAI;QACA,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC7B,EAAE,OAAM;QACJ,OAAO;IACX;AACJ;AAEO,eAAe,cAAc,MAAc,EAAE,KAAa;IAC7D,MAAM,QAAQ,mBAAmB;QAAE;QAAQ;IAAM;IACjD,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,YAAY,GAAG,CAAC,gBAAgB,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ;QACR,MAAM;IACV;IAEA,OAAO;AACX;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,iBAAiB;IAE/C,IAAI,CAAC,OAAO,OAAO;IAEnB,OAAO,mBAAmB;AAC9B;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,MAAM,CAAC;AACvB;AAEO,eAAe;IAClB,MAAM,UAAU,MAAM;IAEtB,IAAI,CAAC,SAAS;QACV,MAAM,IAAI,MAAM;IACpB;IAEA,2BAA2B;IAC3B,MAAM,OAAO,MAAM,4HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACtC,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;IAChC;IAEA,IAAI,CAAC,MAAM;QACP,MAAM;QACN,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO;QAAE;QAAM;IAAQ;AAC3B"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///Users/binivm/Projects/Mini-Projects/UH-Bot/uh-class-alert/src/app/api/subscriptions/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/db';\nimport { requireAuth } from '@/lib/auth';\n\ninterface Subscription {\n    id: string;\n    userId: string;\n    subject: string;\n    catalogNbr: string;\n    title: string | null;\n    active: boolean;\n    createdAt: Date;\n}\n\n// GET /api/subscriptions - List user's subscriptions\nexport async function GET() {\n    try {\n        const { user } = await requireAuth();\n\n        const subscriptions = await prisma.subscription.findMany({\n            where: { userId: user.id, active: true },\n            orderBy: { createdAt: 'desc' },\n        }) as Subscription[];\n\n        // Get current status of each class from cache\n        const subscriptionsWithStatus = await Promise.all(\n            subscriptions.map(async (sub: Subscription) => {\n                const cached = await prisma.classCache.findUnique({\n                    where: {\n                        subject_catalogNbr: {\n                            subject: sub.subject,\n                            catalogNbr: sub.catalogNbr,\n                        },\n                    },\n                });\n\n                return {\n                    ...sub,\n                    isOpen: cached?.isOpen ?? false,\n                    seatsAvailable: cached?.seatsAvailable ?? 0,\n                    lastChecked: cached?.lastChecked ?? null,\n                };\n            })\n        );\n\n        return NextResponse.json({ subscriptions: subscriptionsWithStatus });\n    } catch (error) {\n        if (error instanceof Error && error.message === 'Unauthorized') {\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n        }\n        console.error('Get subscriptions error:', error);\n        return NextResponse.json(\n            { error: 'Failed to get subscriptions' },\n            { status: 500 }\n        );\n    }\n}\n\n// POST /api/subscriptions - Add new subscription\nexport async function POST(request: NextRequest) {\n    try {\n        const { user } = await requireAuth();\n        const body = await request.json();\n        const { subject, catalogNbr, title } = body;\n\n        if (!subject || !catalogNbr) {\n            return NextResponse.json(\n                { error: 'Subject and catalog number are required' },\n                { status: 400 }\n            );\n        }\n\n        // Check if subscription already exists\n        const existing = await prisma.subscription.findUnique({\n            where: {\n                userId_subject_catalogNbr: {\n                    userId: user.id,\n                    subject: subject.toUpperCase(),\n                    catalogNbr: catalogNbr.toString(),\n                },\n            },\n        });\n\n        if (existing) {\n            if (existing.active) {\n                return NextResponse.json(\n                    { error: 'You are already subscribed to this class' },\n                    { status: 400 }\n                );\n            }\n            // Reactivate if it was deactivated\n            const updated = await prisma.subscription.update({\n                where: { id: existing.id },\n                data: { active: true },\n            });\n            return NextResponse.json({ subscription: updated });\n        }\n\n        // Create new subscription\n        const subscription = await prisma.subscription.create({\n            data: {\n                userId: user.id,\n                subject: subject.toUpperCase(),\n                catalogNbr: catalogNbr.toString(),\n                title: title || null,\n            },\n        });\n\n        return NextResponse.json({ subscription }, { status: 201 });\n    } catch (error) {\n        if (error instanceof Error && error.message === 'Unauthorized') {\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n        }\n        console.error('Create subscription error:', error);\n        return NextResponse.json(\n            { error: 'Failed to create subscription' },\n            { status: 500 }\n        );\n    }\n}\n"],"names":[],"mappings":"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"}}]
}