{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/binivm/Projects/Mini-Projects/UH-Bot/uh-class-alert/src/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\nimport { PrismaNeon } from '@prisma/adapter-neon';\n\nconst globalForPrisma = globalThis as unknown as {\n    prisma: PrismaClient | undefined;\n};\n\nfunction createPrismaClient(): PrismaClient {\n    const connectionString = process.env.DATABASE_URL!;\n    const adapter = new PrismaNeon({ connectionString });\n\n    return new PrismaClient({ adapter });\n}\n\nexport const prisma = globalForPrisma.prisma ?? createPrismaClient();\n\nif (process.env.NODE_ENV !== 'production') {\n    globalForPrisma.prisma = prisma;\n}\n\nexport default prisma;\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,kBAAkB;AAIxB,SAAS;IACL,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;IACjD,MAAM,UAAU,IAAI,6KAAU,CAAC;QAAE;IAAiB;IAElD,OAAO,IAAI,sMAAY,CAAC;QAAE;IAAQ;AACtC;AAEO,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C;IACvC,gBAAgB,MAAM,GAAG;AAC7B;uCAEe"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///Users/binivm/Projects/Mini-Projects/UH-Bot/uh-class-alert/src/lib/email.ts"],"sourcesContent":["import { Resend } from 'resend';\n\nconst resend = new Resend(process.env.RESEND_API_KEY);\n\nconst FROM_EMAIL = process.env.EMAIL_FROM || 'UH Class Alert <onboarding@resend.dev>';\n\ninterface ClassInfo {\n    subject: string;\n    catalogNbr: string;\n    courseTitle: string;\n    instructorName: string;\n    seatsAvailable: number;\n}\n\nexport async function sendMagicLink(email: string, token: string) {\n    const appUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';\n    const magicLink = `${appUrl}/verify?token=${token}`;\n\n    const { data, error } = await resend.emails.send({\n        from: FROM_EMAIL,\n        to: email,\n        subject: 'Sign in to UH Class Alert',\n        html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h1 style=\"color: #C8102E;\">UH Class Alert</h1>\n        <p>Click the button below to sign in to your account:</p>\n        <a href=\"${magicLink}\" style=\"display: inline-block; background-color: #C8102E; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold;\">\n          Sign In\n        </a>\n        <p style=\"margin-top: 20px; color: #666; font-size: 14px;\">\n          This link will expire in 1 hour. If you didn't request this, you can safely ignore this email.\n        </p>\n      </div>\n    `,\n    });\n\n    if (error) {\n        console.error('Failed to send magic link:', error);\n        throw new Error('Failed to send email');\n    }\n\n    return data;\n}\n\nexport async function sendClassAlert(email: string, classInfo: ClassInfo) {\n    const appUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';\n\n    const { data, error } = await resend.emails.send({\n        from: FROM_EMAIL,\n        to: email,\n        subject: `ðŸŽ‰ ${classInfo.subject} ${classInfo.catalogNbr} is NOW OPEN!`,\n        html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h1 style=\"color: #C8102E;\">ðŸŽ‰ Class Available!</h1>\n        <div style=\"background-color: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n          <h2 style=\"margin: 0 0 10px 0; color: #333;\">${classInfo.subject} ${classInfo.catalogNbr}</h2>\n          <p style=\"margin: 5px 0; color: #666;\"><strong>Title:</strong> ${classInfo.courseTitle}</p>\n          <p style=\"margin: 5px 0; color: #666;\"><strong>Instructor:</strong> ${classInfo.instructorName}</p>\n          <p style=\"margin: 5px 0; color: #28a745; font-weight: bold;\">\n            <strong>Available Seats:</strong> ${classInfo.seatsAvailable}\n          </p>\n        </div>\n        <a href=\"https://classbrowser.uh.edu\" style=\"display: inline-block; background-color: #C8102E; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold;\">\n          Register Now on UH Class Browser\n        </a>\n        <p style=\"margin-top: 30px; color: #999; font-size: 12px;\">\n          <a href=\"${appUrl}/unsubscribe?email=${encodeURIComponent(email)}\" style=\"color: #999;\">Unsubscribe from alerts</a>\n        </p>\n      </div>\n    `,\n    });\n\n    if (error) {\n        console.error('Failed to send class alert:', error);\n        throw new Error('Failed to send email');\n    }\n\n    return data;\n}\n\nexport async function sendVerificationEmail(email: string, token: string) {\n    return sendMagicLink(email, token);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,SAAS,IAAI,oJAAM,CAAC,QAAQ,GAAG,CAAC,cAAc;AAEpD,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAUtC,eAAe,cAAc,KAAa,EAAE,KAAa;IAC5D,MAAM,SAAS,6DAAmC;IAClD,MAAM,YAAY,GAAG,OAAO,cAAc,EAAE,OAAO;IAEnD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC;QAC7C,MAAM;QACN,IAAI;QACJ,SAAS;QACT,MAAM,CAAC;;;;iBAIE,EAAE,UAAU;;;;;;;IAOzB,CAAC;IACD;IAEA,IAAI,OAAO;QACP,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO;AACX;AAEO,eAAe,eAAe,KAAa,EAAE,SAAoB;IACpE,MAAM,SAAS,6DAAmC;IAElD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC;QAC7C,MAAM;QACN,IAAI;QACJ,SAAS,CAAC,GAAG,EAAE,UAAU,OAAO,CAAC,CAAC,EAAE,UAAU,UAAU,CAAC,aAAa,CAAC;QACvE,MAAM,CAAC;;;;uDAIwC,EAAE,UAAU,OAAO,CAAC,CAAC,EAAE,UAAU,UAAU,CAAC;yEAC1B,EAAE,UAAU,WAAW,CAAC;8EACnB,EAAE,UAAU,cAAc,CAAC;;8CAE3D,EAAE,UAAU,cAAc,CAAC;;;;;;;mBAOtD,EAAE,OAAO,mBAAmB,EAAE,mBAAmB,OAAO;;;IAGvE,CAAC;IACD;IAEA,IAAI,OAAO;QACP,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO;AACX;AAEO,eAAe,sBAAsB,KAAa,EAAE,KAAa;IACpE,OAAO,cAAc,OAAO;AAChC"}},
    {"offset": {"line": 182, "column": 0}, "map": {"version":3,"sources":["file:///Users/binivm/Projects/Mini-Projects/UH-Bot/uh-class-alert/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport { cookies } from 'next/headers';\nimport { prisma } from './db';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'dev-secret-change-in-prod';\nconst SESSION_COOKIE = 'uh-session';\nconst SESSION_EXPIRY = 60 * 60 * 24 * 30; // 30 days\n\ninterface SessionPayload {\n    userId: string;\n    email: string;\n}\n\nexport function generateVerifyToken(): string {\n    return Math.random().toString(36).substring(2) + Date.now().toString(36);\n}\n\nexport function createSessionToken(payload: SessionPayload): string {\n    return jwt.sign(payload, JWT_SECRET, { expiresIn: SESSION_EXPIRY });\n}\n\nexport function verifySessionToken(token: string): SessionPayload | null {\n    try {\n        return jwt.verify(token, JWT_SECRET) as SessionPayload;\n    } catch {\n        return null;\n    }\n}\n\nexport async function createSession(userId: string, email: string) {\n    const token = createSessionToken({ userId, email });\n    const cookieStore = await cookies();\n\n    cookieStore.set(SESSION_COOKIE, token, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        maxAge: SESSION_EXPIRY,\n        path: '/',\n    });\n\n    return token;\n}\n\nexport async function getSession(): Promise<SessionPayload | null> {\n    const cookieStore = await cookies();\n    const token = cookieStore.get(SESSION_COOKIE)?.value;\n\n    if (!token) return null;\n\n    return verifySessionToken(token);\n}\n\nexport async function destroySession() {\n    const cookieStore = await cookies();\n    cookieStore.delete(SESSION_COOKIE);\n}\n\nexport async function requireAuth() {\n    const session = await getSession();\n\n    if (!session) {\n        throw new Error('Unauthorized');\n    }\n\n    // Verify user still exists\n    const user = await prisma.user.findUnique({\n        where: { id: session.userId },\n    });\n\n    if (!user) {\n        await destroySession();\n        throw new Error('Unauthorized');\n    }\n\n    return { user, session };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB;AACvB,MAAM,iBAAiB,KAAK,KAAK,KAAK,IAAI,UAAU;AAO7C,SAAS;IACZ,OAAO,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,KAAK,KAAK,GAAG,GAAG,QAAQ,CAAC;AACzE;AAEO,SAAS,mBAAmB,OAAuB;IACtD,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAe;AACrE;AAEO,SAAS,mBAAmB,KAAa;IAC5C,IAAI;QACA,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC7B,EAAE,OAAM;QACJ,OAAO;IACX;AACJ;AAEO,eAAe,cAAc,MAAc,EAAE,KAAa;IAC7D,MAAM,QAAQ,mBAAmB;QAAE;QAAQ;IAAM;IACjD,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,YAAY,GAAG,CAAC,gBAAgB,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ;QACR,MAAM;IACV;IAEA,OAAO;AACX;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,iBAAiB;IAE/C,IAAI,CAAC,OAAO,OAAO;IAEnB,OAAO,mBAAmB;AAC9B;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,MAAM,CAAC;AACvB;AAEO,eAAe;IAClB,MAAM,UAAU,MAAM;IAEtB,IAAI,CAAC,SAAS;QACV,MAAM,IAAI,MAAM;IACpB;IAEA,2BAA2B;IAC3B,MAAM,OAAO,MAAM,4HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACtC,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;IAChC;IAEA,IAAI,CAAC,MAAM;QACP,MAAM;QACN,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO;QAAE;QAAM;IAAQ;AAC3B"}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///Users/binivm/Projects/Mini-Projects/UH-Bot/uh-class-alert/src/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/db';\nimport { sendMagicLink } from '@/lib/email';\nimport { generateVerifyToken } from '@/lib/auth';\n\nexport async function POST(request: NextRequest) {\n    try {\n        const body = await request.json();\n        const { email } = body;\n\n        if (!email || typeof email !== 'string') {\n            return NextResponse.json(\n                { error: 'Email is required' },\n                { status: 400 }\n            );\n        }\n\n        // Validate email format\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (!emailRegex.test(email)) {\n            return NextResponse.json(\n                { error: 'Invalid email format' },\n                { status: 400 }\n            );\n        }\n\n        // Find or create user\n        let user = await prisma.user.findUnique({\n            where: { email: email.toLowerCase() },\n        });\n\n        const token = generateVerifyToken();\n\n        if (user) {\n            // Update verify token\n            user = await prisma.user.update({\n                where: { id: user.id },\n                data: { verifyToken: token },\n            });\n        } else {\n            // Create new user\n            user = await prisma.user.create({\n                data: {\n                    email: email.toLowerCase(),\n                    verifyToken: token,\n                },\n            });\n        }\n\n        // Send magic link\n        await sendMagicLink(email.toLowerCase(), token);\n\n        return NextResponse.json({\n            success: true,\n            message: 'Check your email for a login link!',\n        });\n    } catch (error) {\n        console.error('Login error:', error);\n        return NextResponse.json(\n            { error: 'Failed to send login email' },\n            { status: 500 }\n        );\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,GAAG;QAElB,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;YACrC,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,wBAAwB;QACxB,MAAM,aAAa;QACnB,IAAI,CAAC,WAAW,IAAI,CAAC,QAAQ;YACzB,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAuB,GAChC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,sBAAsB;QACtB,IAAI,OAAO,MAAM,4HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACpC,OAAO;gBAAE,OAAO,MAAM,WAAW;YAAG;QACxC;QAEA,MAAM,QAAQ,IAAA,2IAAmB;QAEjC,IAAI,MAAM;YACN,sBAAsB;YACtB,OAAO,MAAM,4HAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBAC5B,OAAO;oBAAE,IAAI,KAAK,EAAE;gBAAC;gBACrB,MAAM;oBAAE,aAAa;gBAAM;YAC/B;QACJ,OAAO;YACH,kBAAkB;YAClB,OAAO,MAAM,4HAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBAC5B,MAAM;oBACF,OAAO,MAAM,WAAW;oBACxB,aAAa;gBACjB;YACJ;QACJ;QAEA,kBAAkB;QAClB,MAAM,IAAA,sIAAa,EAAC,MAAM,WAAW,IAAI;QAEzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,SAAS;QACb;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAA6B,GACtC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}